name: Tests

on:
  pull_request:
    branches: [ jlm-with-llvm-16 ]

jobs:
  llvm-test-suite:
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v4
    - name: "Install packages"
      uses: ./.github/actions/InstallPackages
      with:
        install-llvm: true
        install-clang: true
    - name: "Build jlm"
      uses: ./.github/actions/BuildJlm
      with:
        jlm-root-dir: ${{github.workspace}}/../jlm
        cxx: clang++-16
    - name: "Run LLVM test suite"
      run: make llvm-run-opt

  llvm-test-suite-andersen-agnostic:
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v4
    - name: "Install packages"
      uses: ./.github/actions/InstallPackages
      with:
        install-llvm: true
        install-clang: true
    - name: "Build jlm"
      uses: ./.github/actions/BuildJlm
      with:
        jlm-root-dir: ${{github.workspace}}/../jlm
        cxx: clang++-16
    - name: "Run LLVM test suite"
      run: make llvm-run-andersen-agnostic

  llvm-test-suite-steensgaard-agnostic:
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v4
    - name: "Install packages"
      uses: ./.github/actions/InstallPackages
      with:
        install-llvm: true
        install-clang: true
    - name: "Build jlm"
      uses: ./.github/actions/BuildJlm
      with:
        jlm-root-dir: ${{github.workspace}}/../jlm
        cxx: clang++-16
    - name: "Run LLVM test suite"
      run: make llvm-run-steensgaard-agnostic
